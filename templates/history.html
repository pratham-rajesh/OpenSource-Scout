{% extends "base.html" %}

{% block title %}History - OpenSource Scout{% endblock %}

{% block content %}
<h1 style="margin-bottom: 30px;">ğŸ“œ Your Contribution History</h1>

{% if solved_issues %}
    <div class="card" style="margin-bottom: 20px;">
        <div class="stats-grid">
            <div class="stat-box">
                <div class="number">{{ solved_issues|length }}</div>
                <div class="label">Total Solved</div>
            </div>
            <div class="stat-box">
                <div class="number">
                    {% set total_diff = solved_issues|map(attribute='difficulty_rating')|select('number')|list %}
                    {{ (total_diff|sum / total_diff|length)|round(1) if total_diff else 0 }}
                </div>
                <div class="label">Avg Difficulty</div>
            </div>
        </div>
    </div>

    {% for issue in solved_issues %}
    <div class="issue-card">
        <div class="issue-header">
            <a href="{{ issue.issue_url }}" target="_blank" class="issue-title">
                {{ issue.issue_title }}
            </a>
            <span class="difficulty difficulty-{{ issue.difficulty_rating }}">
                {{ issue.difficulty_rating }}/5
            </span>
        </div>
        
        <div class="issue-repo">
            ğŸ“ {{ issue.repo_name }}
            {% if issue.language %}
                | ğŸ”¤ {{ issue.language }}
            {% endif %}
            | ğŸ“… {{ issue.solved_at.strftime('%Y-%m-%d') if issue.solved_at else 'Unknown' }}
        </div>
        
        {% if issue.user_notes %}
        <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
            <strong>Your notes:</strong> {{ issue.user_notes }}
        </div>
        {% endif %}
        
        <div class="issue-actions">
            <a href="{{ issue.issue_url }}" target="_blank" class="btn btn-small btn-secondary">
                View Issue
            </a>
        </div>
    </div>
    {% endfor %}

{% else %}
    <div class="card">
        <div class="empty-state">
            <div class="icon">ğŸ“</div>
            <h3>No solved issues yet</h3>
            <p style="margin: 15px 0;">Start contributing to build your history!</p>
            <a href="{{ url_for('search') }}" class="btn">Find Issues</a>
        </div>
    </div>
{% endif %}
{% endblock %}
